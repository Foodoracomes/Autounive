<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Autoexperten - Kombinerad version</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 20px;
      margin: 20px;
      background: #f9f9f9;
      color: #222;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 20px;
    }
    #priceCustomer, #priceOriginal, #pricePurchase {
      margin: 5px 0;
      font-weight: bold;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input[type="number"] {
      font-size: 1.5em;
      padding: 5px;
      width: 120px;
      margin-top: 5px;
    }
    button {
      font-size: 1.3em;
      padding: 10px 20px;
      margin: 10px 10px 10px 0;
      cursor: pointer;
    }
    button.selected {
      background-color: #4caf50;
      color: white;
    }
    #timingSection {
      margin-top: 20px;
    }
    #sfButtons button {
      margin-right: 10px;
    }
    #summaryContainer {
      margin-top: 20px;
    }
    #summaryBox {
      width: 100%;
      height: 100px;
      font-size: 1.3em;
      padding: 10px;
    }
    .delarContainer {
      margin-top: 20px;
    }
    .delButton {
      font-size: 1.1em;
      margin: 5px;
      padding: 10px;
    }
    .delButton.selected {
      background-color: #2196f3;
      color: white;
    }
  </style>
</head>
<body>

<h1>Autoexperten</h1>

<div id="prices">
  <div id="priceCustomer">Pris till kund: 0 kr</div>
  <div id="priceOriginal">Orginal pris: 0 kr</div>
  <div id="pricePurchase">Inköp pris: 0 kr</div>
</div>

<label for="discountInput">Total rabatt (%):</label>
<input type="number" id="discountInput" min="0" max="100" value="0" />
<div style="margin-top:5px; font-style: italic; color: #555;">Följ Denna mal till 100%</div>

<!-- Delar-knappar -->
<div class="delarContainer">
  <h2>Delar</h2>
  <div id="delarButtons"></div>
</div>

<div id="timingSection">
  <button id="btnInService">I tjänst</button>
  <button id="btnOutService">Ur tjänst</button>
  <div id="labelInService">I tjänst: -</div>
  <div id="labelOutService">Ur tjänst: -</div>
  <div id="labelDuration">Tid (Avrunda till minuter och timmar): -</div>
</div>

<div id="sfSection" style="margin-top: 20px;">
  <div><strong>SF:</strong></div>
  <div id="sfButtons"></div>
</div>

<div id="summaryContainer">
  <textarea id="summaryBox" readonly placeholder="Sammanfattning visas här..."></textarea><br/>
  <button id="copySummary">Kopiera sammanfattning</button>
</div>

<script>
  const delar = {
    "Trimkit A": [5000, 3000, "Trimkit"],
    "Motor B": [15000, 10000, "Motorer"],
    "Filter": [700, 400, "Övrigt"],
    "Olja": [400, 200, "Övrigt"],
    "Kylare C": [2000, 1200, "Kylning"]
  };

  let valdaDelar = [];
  let sfVal = [];
  let startTid = null;
  let slutTid = null;

  // Skapa knappar för delar
  const delarContainer = document.getElementById("delarButtons");
  Object.entries(delar).forEach(([namn, [pris, inkop, kategori]]) => {
    const btn = document.createElement("button");
    btn.className = "delButton";
    btn.textContent = `${namn} - ${pris} kr / Inköp: ${inkop} kr`;
    btn.onclick = () => {
      const index = valdaDelar.indexOf(namn);
      if (index > -1) {
        valdaDelar.splice(index, 1);
        btn.classList.remove("selected");
      } else {
        valdaDelar.push(namn);
        btn.classList.add("selected");
      }
      updatePrices();
      updateSummary();
    };
    delarContainer.appendChild(btn);
  });

  // SF-knappar
  const sfTexts = ["Trimmat", "Tagit intervju", "Fyllt på hyllor"];
  const sfButtonsContainer = document.getElementById("sfButtons");
  sfTexts.forEach(txt => {
    const btn = document.createElement("button");
    btn.textContent = txt;
    btn.onclick = () => {
      if (sfVal.includes(txt)) {
        sfVal = sfVal.filter(x => x !== txt);
        btn.classList.remove("selected");
      } else {
        sfVal.push(txt);
        btn.classList.add("selected");
      }
      updateSummary();
    };
    sfButtonsContainer.appendChild(btn);
  });

  function updatePrices() {
    const prisTillKundEl = document.getElementById("priceCustomer");
    const prisOriginalEl = document.getElementById("priceOriginal");
    const prisInkopEl = document.getElementById("pricePurchase");
    const rabattInput = document.getElementById("discountInput");

    let totalPris = 0;
    let totalInkop = 0;
    let originalPris = 0;

    valdaDelar.forEach(del => {
      let [pris, inkop] = delar[del];
      totalPris += pris;
      totalInkop += inkop;
      originalPris += pris;
    });

    let rabattProcent = parseFloat(rabattInput.value);
    if (isNaN(rabattProcent)) rabattProcent = 0;
    if (rabattProcent > 100) rabattProcent = 100;

    let prisEfterRabatt = totalPris * (1 - rabattProcent / 100);

    prisTillKundEl.textContent = `Pris till kund: ${prisEfterRabatt.toFixed(0)} kr`;
    prisOriginalEl.textContent = `Orginal pris: ${originalPris.toFixed(0)} kr`;
    prisInkopEl.textContent = `Inköp pris: ${totalInkop.toFixed(0)} kr`;
  }

  document.getElementById("discountInput").addEventListener("input", () => {
    updatePrices();
    updateSummary();
  });

  // Tidshantering
  const labelInService = document.getElementById("labelInService");
  const labelOutService = document.getElementById("labelOutService");
  const labelDuration = document.getElementById("labelDuration");

  document.getElementById("btnInService").addEventListener("click", () => {
    startTid = new Date();
    slutTid = null;
    labelInService.textContent = "I tjänst: " + formatDateTime(startTid);
    labelOutService.textContent = "Ur tjänst: -";
    labelDuration.textContent = "Tid (Avrunda till minuter och timmar): -";
    updateSummary();
  });

  document.getElementById("btnOutService").addEventListener("click", () => {
    if (!startTid) {
      alert("Tryck på 'I tjänst' först.");
      return;
    }
    slutTid = new Date();
    labelOutService.textContent = "Ur tjänst: " + formatDateTime(slutTid);
    updateDuration();
    updateSummary();
  });

  function formatDateTime(dt) {
    return dt.toLocaleTimeString("sv-SE", { hour12: false });
  }

  function updateDuration() {
    if (startTid && slutTid) {
      let diffMs = slutTid - startTid;
      let diffMin = Math.round(diffMs / 60000);
      let timmar = Math.floor(diffMin / 60);
      let minuter = diffMin % 60;
      labelDuration.textContent = `Tid (Avrunda till minuter och timmar): ${timmar} tim ${minuter} min`;
    }
  }

  function updateSummary() {
    const summary = document.getElementById("summaryBox");
    let partsText = valdaDelar.length > 0 ? "Delar: " + valdaDelar.join(", ") : "Inga delar valda.";
    let sfText = sfVal.length > 0 ? "SF: " + sfVal.join(", ") : "Ingen SF vald.";
    let tidText = "-";
    if (startTid && slutTid) {
      let diffMs = slutTid - startTid;
      let diffMin = Math.round(diffMs / 60000);
      let timmar = Math.floor(diffMin / 60);
      let minuter = diffMin % 60;
      tidText = `${timmar} tim ${minuter} min`;
    }
    summary.value = `${partsText}\n${sfText}\nTid: ${tidText}`;
  }

  document.getElementById("copySummary").addEventListener("click", () => {
    const text = document.getElementById("summaryBox").value;
    navigator.clipboard.writeText(text).then(() => {
      alert("Sammanfattning kopierad till urklipp!");
    });
  });

  // Init
  updatePrices();
  updateSummary();
</script>

</body>
</html>
